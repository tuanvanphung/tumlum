<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Translating Words to Math & Basic Algebraic Thinking</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #fdfdff;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .controls-container {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .controls-container button {
            padding: 10px 20px;
            font-size: 1em;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 10px;
        }
        #generateTestButton { background-color: #007bff; } /* Blue for generate */
        #generateTestButton:hover { background-color: #0056b3; }
        #showSolutionsButton { background-color: #28a745; }
        #showSolutionsButton:hover { background-color: #218838; }
        #showSolutionsButton:disabled {
            background-color: #6c757d; /* Gray when disabled */
            cursor: not-allowed;
        }

        .problem-list {
            list-style-type: none;
            padding-left: 0;
        }
        .problem-list li {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #fff;
        }
        .problem-number {
            font-weight: bold;
            margin-right: 10px;
            font-size: 1.1em;
        }
        .problem-text-container {
            font-family: 'Georgia', serif;
            font-size: 1.1em;
            color: #444;
            display: block;
            margin-bottom: 10px;
            word-wrap: break-word;
        }
        .answer-space {
            display: block;
            margin-top: 10px;
            font-style: italic;
            color: #777;
        }

        .problem-list li.solutions-shown .problem-text-container,
        .problem-list li.solutions-shown .answer-space,
        .problem-list li.solutions-shown .problem-number {
            /* color: #aaa; Optional: Keep full color if preferred */
        }

        .solution-steps {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background-color: #e9f5ff; /* Light blue background */
            border: 1px dashed #5bc0de; /* Info blue border */
            border-radius: 4px;
            font-family: 'Arial', sans-serif; /* Clear font for solutions */
            font-size: 1.0em;
            line-height: 1.5;
        }
        .solution-steps p {
            margin: 8px 0;
            word-wrap: break-word;
        }
        .solution-steps .final-answer {
            font-weight: bold;
            color: #007bff; /* Primary blue for final answer */
            margin-top:10px;
            padding-top:5px;
            border-top: 1px solid #ccc;
        }
        .highlight-op {
            color: #d9534f;
            font-weight: bold;
            background-color: #f9e6e5;
            padding: 0 2px;
            border-radius: 2px;
        }

        @media print {
            body { margin: 0.5in; }
            .controls-container { display: none; }
            h1 { font-size: 18pt; }
            .problem-list li { page-break-inside: avoid; }
             .problem-list li.solutions-shown .problem-text-container,
            .problem-list li.solutions-shown .answer-space,
            .problem-list li.solutions-shown .problem-number {
                 color: #444 !important; /* Keep original color for print */
            }
            .solution-steps {
                background-color: #fff !important;
                border: 1px solid #ccc !important;
            }
        }
    </style>
</head>
<body>

    <h1>Translating Words to Math & Basic Algebraic Thinking</h1>

    <div class="controls-container">
        <button id="generateTestButton">Generate New Test</button>
        <button id="showSolutionsButton">Show Solutions</button>
    </div>

    <ol class="problem-list" id="problemListContainer">
        <!-- Problems will be dynamically inserted here -->
    </ol>

    <script>
        const problemListContainer = document.getElementById('problemListContainer');
        const showSolutionsBtn = document.getElementById('showSolutionsButton');
        const generateTestBtn = document.getElementById('generateTestButton');

        let currentProblemsData = [];

        // Helper function for random integers
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Helper function for random names
        function getRandomName(gender = null) {
            const maleNames = ["Tom", "Bob", "Mike", "David", "John", "Chris", "Paul", "Mark", "James", "Alex", "Ben", "Sam"];
            const femaleNames = ["Maria", "Alice", "Sarah", "Laura", "Linda", "Karen", "Susan", "Emma", "Olivia", "Sophia", "Mia", "Zoe"];
            const anyNames = [...maleNames, ...femaleNames];
            if (gender === "male") return maleNames[getRandomInt(0, maleNames.length - 1)];
            if (gender === "female") return femaleNames[getRandomInt(0, femaleNames.length - 1)];
            return anyNames[getRandomInt(0, anyNames.length - 1)];
        }

        function generateProblemsData() {
            const problems = [];
            let name1, name2, item1, item2; // For variety

            // --- Category 1: Consecutive Integers (6 problems) ---
            // Problem 1: Sum of three consecutive even/odd, find largest
            let type1 = getRandomInt(0, 1) === 0 ? "even" : "odd";
            let start1_val = getRandomInt(10, 30);
            let int1_1 = start1_val * 2 + (type1 === "odd" ? 1 : 0);
            let int1_2 = int1_1 + 2;
            let int1_3 = int1_1 + 4;
            let sum1 = int1_1 + int1_2 + int1_3;
            problems.push({
                problemText: `The sum of three consecutive ${type1} integers is ${sum1}. What is the largest of these integers?`,
                solutionStepsHTML: `
                    <p>Let the three consecutive ${type1} integers be x, x + 2, and x + 4.</p>
                    <p><strong>Step 1: Set up the equation.</strong></p>
                    <p>x + (x + 2) + (x + 4) = ${sum1}</p>
                    <p>3x + 6 = ${sum1}</p>
                    <p>3x = ${sum1 - 6} = ${int1_1 * 3}</p>
                    <p>x = ${int1_1}</p>
                    <p><strong>Step 2: Find the integers.</strong></p>
                    <p>Smallest: ${int1_1}, Middle: ${int1_2}, Largest: ${int1_3}</p>
                    <p class="final-answer">Final Answer: The largest integer is ${int1_3}.</p>
                `
            });

            // Problem 2: Sum of three consecutive odd/even, find middle
            let type2 = getRandomInt(0, 1) === 0 ? "odd" : "even";
            let start2_val = getRandomInt(15, 35);
            let int2_1 = start2_val * 2 + (type2 === "odd" ? 1 : 0);
            let int2_2 = int2_1 + 2; // middle
            let int2_3 = int2_1 + 4;
            let sum2 = int2_1 + int2_2 + int2_3;
            problems.push({
                problemText: `The sum of three consecutive ${type2} integers is ${sum2}. What is the middle integer?`,
                solutionStepsHTML: `
                    <p>Let the three consecutive ${type2} integers be n, n + 2, and n + 4.</p>
                    <p><strong>Step 1: Set up the equation.</strong></p>
                    <p>n + (n + 2) + (n + 4) = ${sum2}</p>
                    <p>3n + 6 = ${sum2}</p>
                    <p>3n = ${sum2 - 6} = ${int2_1 * 3}</p>
                    <p>n = ${int2_1}</p>
                    <p><strong>Step 2: Identify the integers.</strong></p>
                    <p>First: ${int2_1}, Middle: ${int2_2}, Third: ${int2_3}</p>
                    <p class="final-answer">Final Answer: The middle integer is ${int2_2}.</p>
                `
            });

            // Problem 3: Sum of four consecutive integers, find smallest
            let start3 = getRandomInt(10, 25);
            let int3_1 = start3;
            let int3_2 = start3 + 1;
            let int3_3 = start3 + 2;
            let int3_4 = start3 + 3;
            let sum3 = int3_1 + int3_2 + int3_3 + int3_4;
            problems.push({
                problemText: `The sum of four consecutive integers is ${sum3}. What is the smallest of these integers?`,
                solutionStepsHTML: `
                    <p>Let the integers be x, x+1, x+2, x+3.</p>
                    <p>x + (x+1) + (x+2) + (x+3) = ${sum3}</p>
                    <p>4x + 6 = ${sum3}</p>
                    <p>4x = ${sum3 - 6} = ${4 * start3}</p>
                    <p>x = ${start3}</p>
                    <p class="final-answer">Final Answer: The smallest integer is ${start3}.</p>
                `
            });

            // Problem 4: Product of two consecutive positive integers is Y
            let start4 = getRandomInt(5, 12);
            let prod4 = start4 * (start4 + 1);
            problems.push({
                problemText: `The product of two consecutive positive integers is ${prod4}. What are the integers?`,
                solutionStepsHTML: `
                    <p>Let integers be x and x+1.</p>
                    <p>x(x+1) = ${prod4}. By inspection (or solving x² + x - ${prod4} = 0), we look for consecutive factors of ${prod4}.</p>
                    <p>The factors are ${start4} and ${start4 + 1}.</p>
                    <p>So, x = ${start4}.</p>
                    <p class="final-answer">Final Answer: The integers are ${start4} and ${start4 + 1}.</p>
                `
            });

            // Problem 5: Three consecutive, sum of smallest and largest is Z, find middle
            let start5 = getRandomInt(20, 40);
            let small5 = start5;
            let mid5 = start5 + 1;
            let large5 = start5 + 2;
            let sum_sl5 = small5 + large5;
            problems.push({
                problemText: `For three consecutive integers, the sum of the smallest and the largest is ${sum_sl5}. What is the middle integer?`,
                solutionStepsHTML: `
                    <p>Let integers be n, n+1, n+2.</p>
                    <p>Smallest (n) + Largest (n+2) = ${sum_sl5}</p>
                    <p>2n + 2 = ${sum_sl5}</p>
                    <p>2n = ${sum_sl5 - 2} = ${2 * start5}</p>
                    <p>n = ${start5}</p>
                    <p>Middle integer is n+1 = ${start5} + 1 = ${mid5}.</p>
                    <p class="final-answer">Final Answer: The middle integer is ${mid5}.</p>
                `
            });

            // Problem 6: Sum of two consecutive even integers is X
            let start6_val = getRandomInt(10, 30);
            let int6_1 = start6_val * 2;
            let int6_2 = int6_1 + 2;
            let sum6 = int6_1 + int6_2;
             problems.push({
                problemText: `The sum of two consecutive even integers is ${sum6}. Find the integers.`,
                solutionStepsHTML: `
                    <p>Let the integers be x and x + 2.</p>
                    <p>x + (x + 2) = ${sum6}</p>
                    <p>2x + 2 = ${sum6}</p>
                    <p>2x = ${sum6 - 2} = ${2 * int6_1}</p>
                    <p>x = ${int6_1}</p>
                    <p>The integers are ${int6_1} and ${int6_2}.</p>
                    <p class="final-answer">Final Answer: The integers are ${int6_1} and ${int6_2}.</p>
                `
            });


            // --- Category 2: Geometric Formulas (6 problems) ---
            // Problem 7: Rectangle L = B*W - A, Perimeter P.
            let W7 = getRandomInt(6, 15);
            let B7_multiplier = getRandomInt(2, 3); // "twice" or "three times"
            let A7_less = getRandomInt(1, Math.min(5, W7-1) ); // Ensure positive length and not too large
            let L7 = B7_multiplier * W7 - A7_less;
             while (L7 <=0 || L7 === W7) { // ensure L is positive and different from W
                W7 = getRandomInt(6, 15);
                A7_less = getRandomInt(1, Math.min(5, W7-1) );
                L7 = B7_multiplier * W7 - A7_less;
            }
            let P7 = 2 * (L7 + W7);
            problems.push({
                problemText: `A rectangle's length is ${A7_less} cm less than ${B7_multiplier === 2 ? "twice" : B7_multiplier + " times"} its width. If its perimeter is ${P7} cm, find the dimensions.`,
                solutionStepsHTML: `
                    <p>Let W be width, L be length.</p>
                    <p>L = ${B7_multiplier}W - ${A7_less}</p>
                    <p>P = 2(L + W) = ${P7}</p>
                    <p>2((${B7_multiplier}W - ${A7_less}) + W) = ${P7}</p>
                    <p>2((${B7_multiplier+1})W - ${A7_less}) = ${P7}</p>
                    <p>${2*(B7_multiplier+1)}W - ${2*A7_less} = ${P7}</p>
                    <p>${2*(B7_multiplier+1)}W = ${P7 + 2*A7_less}</p>
                    <p>W = ${(P7 + 2*A7_less) / (2*(B7_multiplier+1))} = ${W7} cm</p>
                    <p>L = ${B7_multiplier}(${W7}) - ${A7_less} = ${L7} cm</p>
                    <p class="final-answer">Final Answer: Width = ${W7} cm, Length = ${L7} cm.</p>
                `
            });

            // Problem 8: Rectangle L = W + A, Perimeter P, find Area.
            let W8 = getRandomInt(5, 10);
            let A8_more = getRandomInt(2, 8);
            let L8 = W8 + A8_more;
            let P8 = 2 * (L8 + W8);
            let Area8 = L8 * W8;
            problems.push({
                problemText: `The length of a rectangle is ${A8_more} m more than its width. If the perimeter is ${P8} m, find the area.`,
                solutionStepsHTML: `
                    <p>Let W be width, L be length.</p>
                    <p>L = W + ${A8_more}</p>
                    <p>P = 2(L + W) = ${P8}</p>
                    <p>2((W + ${A8_more}) + W) = ${P8}</p>
                    <p>2(2W + ${A8_more}) = ${P8}</p>
                    <p>4W + ${2*A8_more} = ${P8}</p>
                    <p>4W = ${P8 - 2*A8_more}</p>
                    <p>W = ${(P8 - 2*A8_more)/4} = ${W8} m</p>
                    <p>L = ${W8} + ${A8_more} = ${L8} m</p>
                    <p>Area = L * W = ${L8} * ${W8} = ${Area8} m².</p>
                    <p class="final-answer">Final Answer: Area = ${Area8} m².</p>
                `
            });

            // Problem 9: Rectangle W = L/N, Perimeter P, find Length.
            let N9_divisor = getRandomInt(2, 4); // "one-half", "one-third", "one-fourth"
            let L9_base = getRandomInt(5,10);
            let L9 = L9_base * N9_divisor; // L is multiple of N
            let W9 = L9 / N9_divisor;
            let P9 = 2 * (L9 + W9);
            let N9_text_map = {2: "one-half", 3: "one-third", 4: "one-fourth"};
            let N9_text = N9_text_map[N9_divisor];
            problems.push({
                problemText: `The width of a rectangle is ${N9_text} its length. If the perimeter is ${P9} cm, find the length.`,
                solutionStepsHTML: `
                    <p>Let L be length, W be width.</p>
                    <p>W = L / ${N9_divisor}</p>
                    <p>P = 2(L + W) = ${P9}</p>
                    <p>2(L + L/${N9_divisor}) = ${P9}</p>
                    <p>2( (${N9_divisor}L + L) / ${N9_divisor} ) = ${P9}</p>
                    <p>2( (${N9_divisor+1})L / ${N9_divisor} ) = ${P9}</p>
                    <p>${2*(N9_divisor+1)}L / ${N9_divisor} = ${P9}</p>
                    <p>${2*(N9_divisor+1)}L = ${P9 * N9_divisor}</p>
                    <p>L = ${ (P9 * N9_divisor) / (2*(N9_divisor+1)) } = ${L9} cm.</p>
                    <p class="final-answer">Final Answer: The length is ${L9} cm.</p>
                `
            });

            // Problem 10: Square perimeter P, find side.
            let s10 = getRandomInt(5, 20);
            let P10 = 4 * s10;
            problems.push({
                problemText: `A square has a perimeter of ${P10} inches. What is the length of one side?`,
                solutionStepsHTML: `
                    <p>Let s be the side length. P = 4s.</p>
                    <p>4s = ${P10}</p>
                    <p>s = ${P10} / 4 = ${s10} inches.</p>
                    <p class="final-answer">Final Answer: Side length is ${s10} inches.</p>
                `
            });

            // Problem 11: Triangle base B more than height H. Area expression.
            let B11_more = getRandomInt(2, 7);
            problems.push({
                problemText: `The base of a triangle is ${B11_more} cm more than its height. If the height is 'h' cm, write an expression for the area of the triangle in terms of 'h'.`,
                solutionStepsHTML: `
                    <p>Height = h. Base (b) = h + ${B11_more}.</p>
                    <p>Area (A) = (1/2) * base * height</p>
                    <p>A = (1/2) * (h + ${B11_more}) * h</p>
                    <p class="final-answer">Final Answer: A = (1/2)h(h + ${B11_more}) or (h² + ${B11_more}h)/2.</p>
                `
            });

            // Problem 12: Rectangle L = N*W, Area A. Dimensions.
            let W12 = getRandomInt(4, 9);
            let N12_times = getRandomInt(2, 3);
            let L12 = N12_times * W12;
            let Area12 = L12 * W12;
            problems.push({
                problemText: `The length of a rectangular garden is ${N12_times === 2 ? "twice" : N12_times + " times"} its width. If the area is ${Area12} square meters, what are its dimensions?`,
                solutionStepsHTML: `
                    <p>Let W be width, L be length. L = ${N12_times}W.</p>
                    <p>Area = L * W = (${N12_times}W) * W = ${N12_times}W².</p>
                    <p>${N12_times}W² = ${Area12}</p>
                    <p>W² = ${Area12 / N12_times} = ${W12*W12}</p>
                    <p>W = ${W12} meters (since width > 0)</p>
                    <p>L = ${N12_times} * ${W12} = ${L12} meters.</p>
                    <p class="final-answer">Final Answer: Width = ${W12} m, Length = ${L12} m.</p>
                `
            });


            // --- Category 3: Coin Problems (5 problems) ---
            // Problem 13: q quarters, d dimes. d = q + D_offset. Value V.
            name1 = getRandomName("female");
            let q13 = getRandomInt(4, 12);
            let D_offset13 = getRandomInt(3, 7);
            let d13 = q13 + D_offset13;
            let V13 = (0.25 * q13 + 0.10 * d13).toFixed(2);
            problems.push({
                problemText: `${name1} has q quarters and d dimes. She has ${D_offset13} more dimes than quarters, and the total value of her coins is $${V13}. Find the number of quarters and dimes ${name1} has.`,
                solutionStepsHTML: `
                    <p>Let q be quarters, d be dimes.</p>
                    <p>d = q + ${D_offset13} (Eq 1)</p>
                    <p>0.25q + 0.10d = ${V13} (Eq 2)</p>
                    <p>Substitute (1) into (2): 0.25q + 0.10(q + ${D_offset13}) = ${V13}</p>
                    <p>0.25q + 0.10q + ${(0.10 * D_offset13).toFixed(2)} = ${V13}</p>
                    <p>0.35q = ${(V13 - 0.10 * D_offset13).toFixed(2)} = ${(0.35 * q13).toFixed(2)}</p>
                    <p>q = ${q13}</p>
                    <p>d = ${q13} + ${D_offset13} = ${d13}</p>
                    <p class="final-answer">Final Answer: ${q13} quarters, ${d13} dimes.</p>
                `
            });

            // Problem 14: Nickels and dimes. Dimes = N * Nickels. Value V.
            name1 = getRandomName("male");
            let n14_nickels = getRandomInt(3, 8);
            let N14_mult = getRandomInt(2, 4); // "twice", "3 times", "4 times"
            let d14_dimes = N14_mult * n14_nickels;
            let V14 = (0.05 * n14_nickels + 0.10 * d14_dimes).toFixed(2);
            problems.push({
                problemText: `${name1} has nickels and dimes. He has ${N14_mult} times as many dimes as nickels. The total value of his coins is $${V14}. How many of each coin does he have?`,
                solutionStepsHTML: `
                    <p>Let n be nickels, d be dimes.</p>
                    <p>d = ${N14_mult}n</p>
                    <p>0.05n + 0.10d = ${V14}</p>
                    <p>0.05n + 0.10(${N14_mult}n) = ${V14}</p>
                    <p>0.05n + ${(0.10 * N14_mult).toFixed(2)}n = ${V14}</p>
                    <p>${(0.05 + 0.10 * N14_mult).toFixed(2)}n = ${V14}</p>
                    <p>n = ${V14 / (0.05 + 0.10 * N14_mult)} = ${n14_nickels}</p>
                    <p>d = ${N14_mult} * ${n14_nickels} = ${d14_dimes}</p>
                    <p class="final-answer">Final Answer: ${n14_nickels} nickels, ${d14_dimes} dimes.</p>
                `
            });

            // Problem 15: X coins (quarters/pennies). Value V. How many quarters?
            item1 = "quarters"; item2 = "pennies";
            let q15 = getRandomInt(10, 25);
            let p15 = getRandomInt(10, 25);
            let total_coins15 = q15 + p15;
            let V15 = (0.25 * q15 + 0.01 * p15).toFixed(2);
            problems.push({
                problemText: `A piggy bank contains only ${item1} and ${item2}. There are ${total_coins15} coins in total. The total value is $${V15}. How many ${item1} are there?`,
                solutionStepsHTML: `
                    <p>Let q be ${item1}, p be ${item2}.</p>
                    <p>q + p = ${total_coins15}  => p = ${total_coins15} - q</p>
                    <p>0.25q + 0.01p = ${V15}</p>
                    <p>0.25q + 0.01(${total_coins15} - q) = ${V15}</p>
                    <p>0.25q + ${(0.01 * total_coins15).toFixed(2)} - 0.01q = ${V15}</p>
                    <p>0.24q = ${(V15 - 0.01 * total_coins15).toFixed(2)} = ${(0.24 * q15).toFixed(2)}</p>
                    <p>q = ${q15}</p>
                    <p class="final-answer">Final Answer: There are ${q15} ${item1}.</p>
                `
            });

            // Problem 16: Value V in dimes/nickels. N more nickels than dimes. Dimes?
            name1 = getRandomName("female");
            let d16 = getRandomInt(5, 15); // dimes
            let N_more16 = getRandomInt(2, 8); // more nickels
            let n16 = d16 + N_more16; // nickels
            let V16 = (0.10 * d16 + 0.05 * n16).toFixed(2);
            problems.push({
                problemText: `${name1} has $${V16} in dimes and nickels. She has ${N_more16} more nickels than dimes. How many dimes does she have?`,
                solutionStepsHTML: `
                    <p>Let d be dimes, n be nickels.</p>
                    <p>n = d + ${N_more16}</p>
                    <p>0.10d + 0.05n = ${V16}</p>
                    <p>0.10d + 0.05(d + ${N_more16}) = ${V16}</p>
                    <p>0.10d + 0.05d + ${(0.05 * N_more16).toFixed(2)} = ${V16}</p>
                    <p>0.15d = ${(V16 - 0.05 * N_more16).toFixed(2)} = ${(0.15 * d16).toFixed(2)}</p>
                    <p>d = ${d16}</p>
                    <p class="final-answer">Final Answer: ${name1} has ${d16} dimes.</p>
                `
            });
            
            // Problem 17: X coins (nickels/quarters). Value V. How many of each?
            let n17 = getRandomInt(5, 20); // nickels
            let q17 = getRandomInt(5, 20); // quarters
            let total_coins17 = n17 + q17;
            let V17 = (0.05 * n17 + 0.25 * q17).toFixed(2);
            problems.push({
                problemText: `A collection of ${total_coins17} coins, consisting of nickels and quarters, has a total value of $${V17}. How many of each coin are there?`,
                solutionStepsHTML: `
                    <p>Let n be nickels, q be quarters.</p>
                    <p>n + q = ${total_coins17} => n = ${total_coins17} - q</p>
                    <p>0.05n + 0.25q = ${V17}</p>
                    <p>0.05(${total_coins17} - q) + 0.25q = ${V17}</p>
                    <p>${(0.05 * total_coins17).toFixed(2)} - 0.05q + 0.25q = ${V17}</p>
                    <p>0.20q = ${(V17 - 0.05 * total_coins17).toFixed(2)} = ${(0.20 * q17).toFixed(2)}</p>
                    <p>q = ${q17}</p>
                    <p>n = ${total_coins17} - ${q17} = ${n17}</p>
                    <p class="final-answer">Final Answer: ${n17} nickels, ${q17} quarters.</p>
                `
            });

            // --- Category 4: Simple Systems of Relationships (5 problems) ---
            // Problem 18: Sum S, Difference D.
            let x18 = getRandomInt(20, 50);
            let y18 = getRandomInt(5, x18 - 3); // y < x and y is somewhat smaller
            let S18 = x18 + y18;
            let D_val18 = x18 - y18;
            problems.push({
                problemText: `The sum of two numbers is ${S18}. Their difference is ${D_val18}. What are the two numbers?`,
                solutionStepsHTML: `
                    <p>Let numbers be x and y. x + y = ${S18}; x - y = ${D_val18}.</p>
                    <p>Add equations: 2x = ${S18 + D_val18} = ${2*x18} => x = ${x18}.</p>
                    <p>Substitute x: ${x18} + y = ${S18} => y = ${S18 - x18} = ${y18}.</p>
                    <p class="final-answer">Final Answer: Numbers are ${x18} and ${y18}.</p>
                `
            });

            // Problem 19: Sum S. One is N times other.
            let y19_small = getRandomInt(5, 15);
            let N19_mult = getRandomInt(2, 5);
            let x19_large = N19_mult * y19_small;
            let S19 = x19_large + y19_small;
            problems.push({
                problemText: `The sum of two numbers is ${S19}. One number is ${N19_mult} times the other. Find the numbers.`,
                solutionStepsHTML: `
                    <p>Let numbers be x and y. Assume x = ${N19_mult}y.</p>
                    <p>x + y = ${S19} => ${N19_mult}y + y = ${S19}</p>
                    <p>(${N19_mult + 1})y = ${S19}</p>
                    <p>y = ${S19 / (N19_mult + 1)} = ${y19_small}.</p>
                    <p>x = ${N19_mult} * ${y19_small} = ${x19_large}.</p>
                    <p class="final-answer">Final Answer: Numbers are ${x19_large} and ${y19_small}.</p>
                `
            });

            // Problem 20: Difference D. Larger is A more than N times smaller.
            let S20_small = getRandomInt(5, 12);
            let N20_mult = getRandomInt(2, 3);
            let A20_more = getRandomInt(1, 8);
            let L20_large = N20_mult * S20_small + A20_more;
            let D_val20 = L20_large - S20_small;
            problems.push({
                problemText: `The difference between two numbers is ${D_val20}. The larger number is ${A20_more} more than ${N20_mult === 2 ? "twice" : N20_mult+" times"} the smaller number. Find the numbers.`,
                solutionStepsHTML: `
                    <p>Let L be larger, S be smaller.</p>
                    <p>L - S = ${D_val20}</p>
                    <p>L = ${N20_mult}S + ${A20_more}</p>
                    <p>Substitute: (${N20_mult}S + ${A20_more}) - S = ${D_val20}</p>
                    <p>(${N20_mult - 1})S + ${A20_more} = ${D_val20}</p>
                    <p>(${N20_mult - 1})S = ${D_val20 - A20_more}</p>
                    <p>S = ${ (D_val20 - A20_more) / (N20_mult - 1) } = ${S20_small}.</p>
                    <p>L = ${N20_mult}(${S20_small}) + ${A20_more} = ${L20_large}.</p>
                    <p class="final-answer">Final Answer: Numbers are ${L20_large} and ${S20_small}.</p>
                `
            });

            // Problem 21: One number A less than another. Sum S.
            let y21_large = getRandomInt(15, 30);
            let A21_less = getRandomInt(3, 10);
             while (y21_large - A21_less <= 0) { // Ensure smaller number is positive
                y21_large = getRandomInt(15,30);
                A21_less = getRandomInt(3,10);
            }
            let x21_small = y21_large - A21_less;
            let S21 = x21_small + y21_large;
            problems.push({
                problemText: `One number is ${A21_less} less than another. Their sum is ${S21}. Find the numbers.`,
                solutionStepsHTML: `
                    <p>Let numbers be x and y, with x = y - ${A21_less}.</p>
                    <p>x + y = ${S21}</p>
                    <p>(y - ${A21_less}) + y = ${S21}</p>
                    <p>2y - ${A21_less} = ${S21}</p>
                    <p>2y = ${S21 + A21_less}</p>
                    <p>y = ${(S21 + A21_less) / 2} = ${y21_large}.</p>
                    <p>x = ${y21_large} - ${A21_less} = ${x21_small}.</p>
                    <p class="final-answer">Final Answer: Numbers are ${x21_small} and ${y21_large}.</p>
                `
            });

            // Problem 22: Sum S. Larger is A more than N times smaller.
            let S22_small = getRandomInt(6, 14);
            let N22_mult = getRandomInt(2, 3);
            let A22_more = getRandomInt(1, 7);
            let L22_large = N22_mult * S22_small + A22_more;
            let S_sum22 = S22_small + L22_large;
            problems.push({
                problemText: `Two numbers have a sum of ${S_sum22}. The larger number is ${A22_more} more than ${N22_mult === 2 ? "twice" : N22_mult+" times"} the smaller number. Find the numbers.`,
                solutionStepsHTML: `
                    <p>Let S be smaller, L be larger.</p>
                    <p>S + L = ${S_sum22}</p>
                    <p>L = ${N22_mult}S + ${A22_more}</p>
                    <p>Substitute: S + (${N22_mult}S + ${A22_more}) = ${S_sum22}</p>
                    <p>(${N22_mult + 1})S + ${A22_more} = ${S_sum22}</p>
                    <p>(${N22_mult + 1})S = ${S_sum22 - A22_more}</p>
                    <p>S = ${(S_sum22 - A22_more) / (N22_mult + 1)} = ${S22_small}.</p>
                    <p>L = ${N22_mult}(${S22_small}) + ${A22_more} = ${L22_large}.</p>
                    <p class="final-answer">Final Answer: Numbers are ${S22_small} and ${L22_large}.</p>
                `
            });

            // --- Category 5: Working Backwards (5 problems) ---
            // Problem 23: Doubled, +A, /B = C
            let original23 = getRandomInt(10, 25);
            let A23_add = getRandomInt(3, 9);
            let B23_div = getRandomInt(2, 5);
            while ((2 * original23 + A23_add) % B23_div !== 0) { // Ensure integer result C
                original23 = getRandomInt(10, 25); A23_add = getRandomInt(3,9); B23_div = getRandomInt(2,5);
            }
            let C23_res = (2 * original23 + A23_add) / B23_div;
            problems.push({
                problemText: `A number is doubled, then increased by ${A23_add}. The result is then divided by ${B23_div}, yielding ${C23_res}. What was the original number?`,
                solutionStepsHTML: `
                    <p>Let x be original. ((2x + ${A23_add}) / ${B23_div}) = ${C23_res}.</p>
                    <p>Work backwards: 2x + ${A23_add} = ${C23_res} * ${B23_div} = ${C23_res * B23_div}.</p>
                    <p>2x = ${C23_res * B23_div} - ${A23_add} = ${2 * original23}.</p>
                    <p>x = ${original23}.</p>
                    <p class="final-answer">Final Answer: Original was ${original23}.</p>
                `
            });

            // Problem 24: Tripled, -A = B
            let original24 = getRandomInt(5, 15);
            let A24_sub = getRandomInt(2, 10);
            let B24_res = 3 * original24 - A24_sub;
            problems.push({
                problemText: `A number is tripled, then decreased by ${A24_sub}. The result is ${B24_res}. What is the original number?`,
                solutionStepsHTML: `
                    <p>Let x be original. 3x - ${A24_sub} = ${B24_res}.</p>
                    <p>3x = ${B24_res} + ${A24_sub} = ${3 * original24}.</p>
                    <p>x = ${original24}.</p>
                    <p class="final-answer">Final Answer: Original is ${original24}.</p>
                `
            });

            // Problem 25: (Number - A) * B = C
            let A25_sub = getRandomInt(3, 10);
            let original25 = getRandomInt(A25_sub + 2, 25); // Ensure original > A
            let B25_mult = getRandomInt(2, 5);
            let C25_res = (original25 - A25_sub) * B25_mult;
            problems.push({
                problemText: `If you take a number, subtract ${A25_sub} from it, then multiply by ${B25_mult}, the result is ${C25_res}. What is the number?`,
                solutionStepsHTML: `
                    <p>Let n be number. (n - ${A25_sub}) * ${B25_mult} = ${C25_res}.</p>
                    <p>n - ${A25_sub} = ${C25_res} / ${B25_mult} = ${(original25 - A25_sub)}.</p>
                    <p>n = ${(original25 - A25_sub)} + ${A25_sub} = ${original25}.</p>
                    <p class="final-answer">Final Answer: Number is ${original25}.</p>
                `
            });
            
            // Problem 26: Number / A, +B = C
            let A26_div = getRandomInt(2, 4);
            let original26_base = getRandomInt(5, 10);
            let original26 = original26_base * A26_div; // Ensure divisible by A
            let B26_add = getRandomInt(3, 9);
            let C26_res = (original26 / A26_div) + B26_add;
            problems.push({
                problemText: `A number is divided by ${A26_div}, then ${B26_add} is added. The result is ${C26_res}. What is the original number?`,
                solutionStepsHTML: `
                    <p>Let x be original. (x / ${A26_div}) + ${B26_add} = ${C26_res}.</p>
                    <p>x / ${A26_div} = ${C26_res} - ${B26_add} = ${original26 / A26_div}.</p>
                    <p>x = (${original26 / A26_div}) * ${A26_div} = ${original26}.</p>
                    <p class="final-answer">Final Answer: Original number is ${original26}.</p>
                `
            });

            // Problem 27: Add A, Mult B, Sub C = D
            let original27 = getRandomInt(3, 8);
            let A27_add = getRandomInt(2, 6);
            let B27_mult = getRandomInt(2, 4);
            let C27_sub = getRandomInt(1, 5);
            let D27_res = (original27 + A27_add) * B27_mult - C27_sub;
            problems.push({
                problemText: `Start with a number. Add ${A27_add} to it. Multiply the sum by ${B27_mult}. Subtract ${C27_sub} from the product. The result is ${D27_res}. What was the number?`,
                solutionStepsHTML: `
                    <p>Let n be number. ((n + ${A27_add}) * ${B27_mult}) - ${C27_sub} = ${D27_res}.</p>
                    <p>(n + ${A27_add}) * ${B27_mult} = ${D27_res} + ${C27_sub} = ${(original27 + A27_add) * B27_mult}.</p>
                    <p>n + ${A27_add} = ${((original27 + A27_add) * B27_mult) / B27_mult} = ${original27 + A27_add}.</p>
                    <p>n = ${original27 + A27_add} - ${A27_add} = ${original27}.</p>
                    <p class="final-answer">Final Answer: Number was ${original27}.</p>
                `
            });

            // --- Category 6: Age Problems (Simple Systems - 3 problems) ---
            // Problem 28: P1 A years older than P2. Sum S. Age P2?
            name1 = getRandomName(); name2 = getRandomName(); while(name1 === name2) name2=getRandomName();
            let p2_age28 = getRandomInt(7, 18);
            let A_offset28 = getRandomInt(2, 9);
            let p1_age28 = p2_age28 + A_offset28;
            let S_age28 = p1_age28 + p2_age28;
            problems.push({
                problemText: `${name1} is ${A_offset28} years older than ${name2}. The sum of their ages is ${S_age28}. How old is ${name2}?`,
                solutionStepsHTML: `
                    <p>Let ${name1[0]} be ${name1}'s age, ${name2[0]} be ${name2}'s age.</p>
                    <p>${name1[0]} = ${name2[0]} + ${A_offset28}</p>
                    <p>${name1[0]} + ${name2[0]} = ${S_age28}</p>
                    <p>Substitute: (${name2[0]} + ${A_offset28}) + ${name2[0]} = ${S_age28}</p>
                    <p>2${name2[0]} + ${A_offset28} = ${S_age28}</p>
                    <p>2${name2[0]} = ${S_age28 - A_offset28} = ${2 * p2_age28}</p>
                    <p>${name2[0]} = ${p2_age28}</p>
                    <p class="final-answer">Final Answer: ${name2} is ${p2_age28} years old.</p>
                `
            });

            // Problem 29: P1 N times P2. In X years, sum S. P2's current age?
            name1 = getRandomName(); name2 = getRandomName(); while(name1 === name2) name2=getRandomName();
            let b_now29 = getRandomInt(5, 10); // P2's current age
            let N_mult29 = getRandomInt(2, 4); // P1 is N times P2
            let a_now29 = N_mult29 * b_now29;
            let X_years29 = getRandomInt(3, 7); // In X years
            let a_future29 = a_now29 + X_years29;
            let b_future29 = b_now29 + X_years29;
            let S_future_sum29 = a_future29 + b_future29;
            problems.push({
                problemText: `${name1} is ${N_mult29} times as old as ${name2}. In ${X_years29} years, the sum of their ages will be ${S_future_sum29}. How old is ${name2} now?`,
                solutionStepsHTML: `
                    <p>Let ${name1[0]} be ${name1}'s current age, ${name2[0]} be ${name2}'s current age.</p>
                    <p>${name1[0]} = ${N_mult29}${name2[0]}.</p>
                    <p>In ${X_years29} years: ${name1[0]} is ${name1[0]}+${X_years29}, ${name2[0]} is ${name2[0]}+${X_years29}.</p>
                    <p>Sum in ${X_years29} years: (${name1[0]}+${X_years29}) + (${name2[0]}+${X_years29}) = ${S_future_sum29}</p>
                    <p>Substitute ${name1[0]}: (${N_mult29}${name2[0]}+${X_years29}) + (${name2[0]}+${X_years29}) = ${S_future_sum29}</p>
                    <p>(${N_mult29+1})${name2[0]} + ${2*X_years29} = ${S_future_sum29}</p>
                    <p>(${N_mult29+1})${name2[0]} = ${S_future_sum29 - 2*X_years29} = ${(N_mult29+1)*b_now29}</p>
                    <p>${name2[0]} = ${b_now29}</p>
                    <p class="final-answer">Final Answer: ${name2} is currently ${b_now29} years old.</p>
                `
            });

            // Problem 30: Mother N times daughter. Difference D. Daughter's age?
            let d_age30 = getRandomInt(6, 12); // Daughter's age
            let N_mult_m30 = getRandomInt(3, 5); // Mother N times older
            let m_age30 = N_mult_m30 * d_age30;
            let diff_age30 = m_age30 - d_age30;
            problems.push({
                problemText: `A mother is ${N_mult_m30} times as old as her daughter. The difference in their ages is ${diff_age30} years. How old is the daughter?`,
                solutionStepsHTML: `
                    <p>Let M be mother's age, D be daughter's age.</p>
                    <p>M = ${N_mult_m30}D</p>
                    <p>M - D = ${diff_age30}</p>
                    <p>Substitute: ${N_mult_m30}D - D = ${diff_age30}</p>
                    <p>(${N_mult_m30 - 1})D = ${diff_age30}</p>
                    <p>D = ${diff_age30 / (N_mult_m30 - 1)} = ${d_age30}</p>
                    <p class="final-answer">Final Answer: The daughter is ${d_age30} years old.</p>
                `
            });

            return problems;
        }


        function displayProblems() {
            currentProblemsData = generateProblemsData(); // Generate new problems
            problemListContainer.innerHTML = ''; // Clear existing problems
            
            // Reset solutions button
            showSolutionsBtn.textContent = 'Show Solutions';
            showSolutionsBtn.disabled = false;

            currentProblemsData.forEach((data, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span class="problem-number">${index + 1}.</span>
                    <div class="problem-text-container">${data.problemText}</div>
                    <span class="answer-space">Answer: ____________</span>
                    <div class="solution-steps" id="solution-${index + 1}">
                        ${data.solutionStepsHTML}
                    </div>
                `;
                problemListContainer.appendChild(listItem);
            });

            // Ensure solutions are initially hidden
            const solutions = document.querySelectorAll('.solution-steps');
            solutions.forEach(sol => sol.style.display = 'none');
            const problemItems = document.querySelectorAll('.problem-list > li');
            problemItems.forEach(item => item.classList.remove('solutions-shown'));
        }

        function showSolutions() {
            const solutions = document.querySelectorAll('.solution-steps');
            const problemItems = document.querySelectorAll('.problem-list > li');

            if (solutions.length === 0) return;

            let allSolutionsVisible = true;
            solutions.forEach(sol => {
                if (sol.style.display === 'none') {
                    allSolutionsVisible = false;
                }
            });

            if (allSolutionsVisible) {
                // This state means solutions are already shown and button is disabled.
            } else {
                solutions.forEach(sol => sol.style.display = 'block');
                problemItems.forEach(item => item.classList.add('solutions-shown'));
                showSolutionsBtn.textContent = 'Solutions Shown';
                showSolutionsBtn.disabled = true; // Disable after showing
            }
        }

        showSolutionsBtn.addEventListener('click', showSolutions);
        generateTestBtn.addEventListener('click', displayProblems);

        // Load initial set of problems on page load
        displayProblems(); 

    </script>
</body>
</html>