<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algebra Mastery: Squares, Roots & Absolute Values</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f0f2f5; color: #333; }
        h1 { text-align: center; color: #1a2a6c; margin-bottom: 5px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        
        .controls-container { text-align: center; padding: 20px; margin-bottom: 30px; background-color: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        button { padding: 12px 28px; font-size: 1.05em; color: white; border: none; border-radius: 6px; cursor: pointer; margin: 5px 10px; transition: 0.2s; }
        #generateBtn { background-color: #3498db; }
        #showSolutionsBtn { background-color: #27ae60; }
        #showSolutionsBtn:disabled { background-color: #7f8c8d; opacity: 1; cursor: default; }

        .problem-list { list-style-type: none; padding-left: 0; max-width: 850px; margin: 0 auto; }
        .problem-card { margin-bottom: 30px; padding: 25px; border-radius: 12px; background-color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-left: 8px solid #ddd; }
        
        .problem-header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; }
        .problem-number { font-weight: bold; font-size: 1.3em; color: #95a5a6; }
        .problem-expression { font-family: 'Times New Roman', serif; font-size: 1.8em; color: #2c3e50; font-style: italic; }
        
        .answer-box { display: flex; flex-direction: column; background: #fdfdfd; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .user-input { padding: 10px; font-size: 1.2em; border: 2px solid #ced4da; border-radius: 6px; width: 220px; margin-left: 10px; text-align: center; }
        .input-hint { font-size: 0.85em; color: #888; margin-top: 5px; margin-left: 30px; }
        
        /* Math Formatting */
        .sqrt { border-top: 2px solid black; padding-top: 2px; margin-left: 2px; }
        .radical { font-size: 1.2em; vertical-align: middle; }
        .fraction { display: inline-block; vertical-align: middle; text-align: center; margin: 0 0.2em; font-style: normal; }
        .num { display: block; border-bottom: 1px solid black; padding: 0 5px; }
        .den { display: block; padding: 0 5px; }

        .solution-area { display: none; margin-top: 20px; padding: 20px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
        .algebra-line { display: block; font-family: 'Courier New', monospace; background: #fff; padding: 8px; border: 1px solid #ddd; border-radius: 4px; color: #d35400; margin: 5px 0; font-weight: bold; }
        
        .correct-input { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .incorrect-input { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }

        .report-header { text-align: center; background: white; border: 3px solid #27ae60; padding: 20px; margin-bottom: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        @media print { .controls-container { display: none; } .solution-area { display: block !important; } }
    </style>
</head>
<body>

    <h1>Algebra: Solving for <i>x</i></h1>
    <p class="subtitle">Radicals, Square Powers, Absolute Values, and Rational Fractions.</p>

    <div class="controls-container">
        <button id="generateBtn">New Set of 6 Problems</button>
        <button id="showSolutionsBtn">Submit & Generate Report</button> 
    </div>

    <div id="problemContainer" class="problem-list"></div>

    <script>
        const container = document.getElementById('problemContainer');
        const generateBtn = document.getElementById('generateBtn');
        const showBtn = document.getElementById('showSolutionsBtn');
        let currentProblems = [];

        function getRandom(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

        function generateProblem(id, type) {
            let prob = { id, lhs: "", rhs: "", steps: [], correctAnswers: [], hint: "" };

            switch(type) {
                case 'radical':
                    // sqrt(x - a) = b
                    let a_r = getRandom(2, 20);
                    let b_r = getRandom(3, 10);
                    let ans_r = (b_r * b_r) + a_r;
                    prob.lhs = `<span class="radical">&radic;</span><span class="sqrt">x - ${a_r}</span>`;
                    prob.rhs = `${b_r}`;
                    prob.correctAnswers = [ans_r.toString()];
                    prob.steps.push({m: "Square both sides to remove the radical:", l: `x - ${a_r} = ${b_r}^2`});
                    prob.steps.push({m: "Simplify and add " + a_r + ":", l: `x = ${b_r * b_r} + ${a_r}`});
                    break;

                case 'absolute':
                    // |x + a| = b
                    let a_abs = getRandom(5, 25);
                    let b_abs = getRandom(5, 15);
                    let ans1 = b_abs - a_abs;
                    let ans2 = -b_abs - a_abs;
                    prob.lhs = `| x + ${a_abs} |`;
                    prob.rhs = `${b_abs}`;
                    prob.correctAnswers = [ans1.toString(), ans2.toString()];
                    prob.hint = "Enter two numbers separated by a comma.";
                    prob.steps.push({m: "Split into two linear equations:", l: `x + ${a_abs} = ${b_abs} OR x + ${a_abs} = -${b_abs}`});
                    prob.steps.push({m: "Subtract " + a_abs + " from both:", l: `x = ${ans1}, x = ${ans2}`});
                    break;

                case 'quadratic':
                    // ax^2 = b
                    let a_q = getRandom(2, 5);
                    let x_q = getRandom(2, 7);
                    let b_q = a_q * (x_q * x_q);
                    prob.lhs = `${a_q}x<sup>2</sup>`;
                    prob.rhs = `${b_q}`;
                    prob.correctAnswers = [x_q.toString(), (-x_q).toString()];
                    prob.hint = "Enter two numbers (positive and negative).";
                    prob.steps.push({m: "Divide both sides by " + a_q + ":", l: `x^2 = ${b_q / a_q}`});
                    prob.steps.push({m: "Take the square root (±):", l: `x = ±√${b_q / a_q}`});
                    prob.steps.push({m: "Result:", l: `x = ${x_q}, -${x_q}`});
                    break;

                case 'rational':
                    // a / x = b
                    let x_rat = getRandom(2, 8);
                    let b_rat = getRandom(2, 6);
                    let a_rat = x_rat * b_rat;
                    prob.lhs = `<div class="fraction"><span class="num">${a_rat}</span><span class="den">x</span></div>`;
                    prob.rhs = `${b_rat}`;
                    prob.correctAnswers = [x_rat.toString()];
                    prob.steps.push({m: "Multiply both sides by x:", l: `${a_rat} = ${b_rat}x`});
                    prob.steps.push({m: "Divide by " + b_rat + ":", l: `x = ${x_rat}`});
                    break;

                case 'two_step_sqrt':
                    // sqrt(x) + a = b
                    let a_ts = getRandom(1, 10);
                    let b_ts = a_ts + getRandom(2, 6);
                    let ans_ts = (b_ts - a_ts) * (b_ts - a_ts);
                    prob.lhs = `<span class="radical">&radic;</span><span class="sqrt">x</span> + ${a_ts}`;
                    prob.rhs = `${b_ts}`;
                    prob.correctAnswers = [ans_ts.toString()];
                    prob.steps.push({m: "Isolate the radical by subtracting " + a_ts + ":", l: `√x = ${b_ts - a_ts}`});
                    prob.steps.push({m: "Square both sides:", l: `x = ${b_ts - a_ts}^2`});
                    break;

                case 'abs_quad':
                    // |x^2 - a| = b (specifically designed to have 2 solutions only for simplicity)
                    // |x^2 - 10| = 15 => x^2=25 (5,-5) and x^2=-5 (none)
                    prob.lhs = `| x<sup>2</sup> - 10 |`;
                    prob.rhs = `15`;
                    prob.correctAnswers = ["5", "-5"];
                    prob.hint = "Solve for x. (Hint: One side will have no real solution).";
                    prob.steps.push({m: "Split into two cases:", l: `x^2 - 10 = 15 OR x^2 - 10 = -15`});
                    prob.steps.push({m: "Solve Case 1:", l: `x^2 = 25 -> x = 5, -5`});
                    prob.steps.push({m: "Solve Case 2:", l: `x^2 = -5 -> No real solution`});
                    break;
            }
            return prob;
        }

        function render() {
            container.innerHTML = ''; currentProblems = [];
            showBtn.disabled = false; showBtn.style.backgroundColor = '#27ae60'; showBtn.textContent = "Submit & Generate Report";
            const types = ['radical', 'absolute', 'quadratic', 'rational', 'two_step_sqrt', 'abs_quad'];
            
            for (let i = 1; i <= 6; i++) {
                const p = generateProblem(i, types[i-1]); 
                currentProblems.push(p);
                const div = document.createElement('div');
                div.className = 'problem-card';
                div.innerHTML = `
                    <div class="problem-header"><span class="problem-number">#${i}</span><div class="problem-expression">${p.lhs} = ${p.rhs}</div></div>
                    <div class="answer-box">
                        <div style="display:flex; align-items:center;"><label>x = </label><input type="text" class="user-input" id="input-${i}" placeholder="?"></div>
                        <div class="input-hint">${p.hint || "Enter the numeric answer."}</div>
                    </div>
                    <div class="solution-area" id="sol-${i}">
                        <strong>Step-by-Step Solution:</strong>
                        ${p.steps.map(s => `<div class="step-row">${s.m}<span class="algebra-line">${s.l}</span></div>`).join('')}
                        <div style="color:#2980b9; font-weight:bold; margin-top:10px;">Final Answers: ${p.correctAnswers.join(', ')}</div>
                    </div>`;
                container.appendChild(div);
            }
        }

        function check() {
            let score = 0;
            currentProblems.forEach(p => {
                const input = document.getElementById(`input-${p.id}`);
                const userVal = input.value.replace(/\s+/g, '');
                let userArr = userVal.split(',').map(s => s.trim()).filter(s => s !== "");
                
                // Compare arrays (order independent)
                let isCorrect = (userArr.length === p.correctAnswers.length) && 
                                 userArr.every(val => p.correctAnswers.includes(val));

                input.classList.add(isCorrect ? 'correct-input' : 'incorrect-input');
                document.getElementById(`sol-${p.id}`).style.display = 'block';
                if (isCorrect) score++;
            });

            const timeStr = new Date().toLocaleString();
            showBtn.disabled = true;
            showBtn.innerHTML = `Final Score: ${score}/6<br><small>${timeStr}</small>`;
            
            // Auto-downloading static report
            const clone = document.documentElement.cloneNode(true);
            clone.querySelectorAll('script, .controls-container').forEach(el => el.remove());
            const body = clone.querySelector('body');
            const header = document.createElement('div');
            header.className = 'report-header';
            header.innerHTML = `<h1>Algebra Report</h1><h2>Score: ${score} / 6</h2><p>Date: ${timeStr}</p>`;
            body.insertBefore(header, body.firstChild);
            
            const inputs = clone.querySelectorAll('.user-input');
            document.querySelectorAll('.user-input').forEach((original, idx) => {
                const span = document.createElement('span');
                span.textContent = original.value || "Empty";
                span.className = original.className + " static-answer";
                span.style.padding = "5px 15px";
                span.style.border = "1px solid #ccc";
                inputs[idx].parentNode.replaceChild(span, inputs[idx]);
            });

            clone.querySelectorAll('.solution-area').forEach(s => s.style.display = 'block');
            const blob = new Blob(['<!DOCTYPE html>\n' + clone.outerHTML], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `Algebra_Mastery_Report.html`;
            a.click();
        }

        generateBtn.addEventListener('click', render);
        showBtn.addEventListener('click', check);
        render();
    </script>
</body>
</html>